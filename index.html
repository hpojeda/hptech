<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Orçamento - Manutenção de PC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .item-row {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* bg-gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* bg-gray-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-cyan-400">Gerador de Orçamento</h1>
            <p class="text-gray-400 mt-2">Crie e compartilhe orçamentos de manutenção de forma rápida.</p>
        </header>

        <!-- Formulário Principal -->
        <main class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl space-y-8">
            
            <!-- Seção de Dados do Cliente e Equipamento -->
            <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold border-l-4 border-cyan-400 pl-3">Dados do Cliente</h2>
                    <div>
                        <label for="clientName" class="block text-sm font-medium text-gray-300 mb-1">Nome do Cliente</label>
                        <input type="text" id="clientName" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Ex: João da Silva">
                    </div>
                    <div>
                        <label for="clientContact" class="block text-sm font-medium text-gray-300 mb-1">Contato (Telefone/Email)</label>
                        <input type="text" id="clientContact" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Ex: (11) 99999-8888">
                    </div>
                </div>
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold border-l-4 border-cyan-400 pl-3">Dados do Equipamento</h2>
                    <div>
                        <label for="deviceBrand" class="block text-sm font-medium text-gray-300 mb-1">Marca</label>
                        <input type="text" id="deviceBrand" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Ex: Dell, HP, Apple">
                    </div>
                    <div>
                        <label for="deviceModel" class="block text-sm font-medium text-gray-300 mb-1">Modelo</label>
                        <input type="text" id="deviceModel" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Ex: Inspiron 15, Pavilion, MacBook Pro">
                    </div>
                </div>
            </section>
            
            <!-- Linha Divisória -->
            <hr class="border-gray-700">

            <!-- Seção de Serviços -->
            <section>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold border-l-4 border-cyan-400 pl-3">Serviços Prestados</h2>
                    <button id="add-service" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg transition shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-cyan-500">
                        + Adicionar Serviço
                    </button>
                </div>
                <div id="services-list" class="space-y-3">
                    <!-- Linhas de serviço serão adicionadas aqui via JS -->
                </div>
            </section>

            <!-- Seção de Peças -->
            <section>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold border-l-4 border-cyan-400 pl-3">Peças / Componentes</h2>
                    <button id="add-part" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg transition shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-cyan-500">
                        + Adicionar Peça
                    </button>
                </div>
                <div id="parts-list" class="space-y-3">
                    <!-- Linhas de peças serão adicionadas aqui via JS -->
                </div>
            </section>

            <!-- Linha Divisória -->
            <hr class="border-gray-700">

            <!-- Seção Total -->
            <section class="flex justify-end items-center mt-6">
                <h2 class="text-2xl font-bold mr-4 text-gray-300">Valor Total:</h2>
                <div id="total-value" class="text-3xl font-bold text-green-400 bg-gray-900 px-6 py-3 rounded-lg shadow-inner">
                    R$ 0,00
                </div>
            </section>

            <!-- Seção de Ações -->
            <section class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-8 pt-6 border-t border-gray-700">
                 <button id="generate-budget" class="w-full sm:w-auto bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg text-lg transition shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-green-500">
                    Gerar e Compartilhar Orçamento
                </button>
                <button id="reset-form" type="button" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-gray-500">
                    Limpar Tudo
                </button>
            </section>
        </main>
    </div>

    <!-- Modal para notificação -->
    <div id="notification" class="fixed bottom-5 right-5 bg-cyan-500 text-white py-2 px-4 rounded-lg shadow-lg transition-transform translate-y-20 opacity-0">
        Orçamento copiado para a área de transferência!
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Seletores dos elementos principais
    const addServiceBtn = document.getElementById('add-service');
    const addPartBtn = document.getElementById('add-part');
    const servicesList = document.getElementById('services-list');
    const partsList = document.getElementById('parts-list');
    const generateBtn = document.getElementById('generate-budget');
    const resetBtn = document.getElementById('reset-form');

    // Contador para IDs únicos
    let itemId = 0;

    /**
     * Adiciona um novo item (serviço ou peça) à lista correspondente.
     * @param {string} type - 'service' ou 'part'
     * @param {string} listElementId - ID do elemento da lista (services-list ou parts-list)
     */
    const addItem = (type, listElementId) => {
        itemId++;
        const list = document.getElementById(listElementId);
        
        const placeholderText = type === 'service' ? 'Ex: Formatação com backup' : 'Ex: SSD 240GB Kingston';
        const itemRow = document.createElement('div');
        itemRow.classList.add('flex', 'gap-2', 'items-center', 'item-row');
        itemRow.setAttribute('data-id', itemId);

        itemRow.innerHTML = `
            <div class="flex-grow">
                <input type="text" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition ${type}-desc" placeholder="${placeholderText}">
            </div>
            <div class="w-32">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">R$</span>
                    <input type="number" step="0.01" min="0" class="w-full bg-gray-700 border border-gray-600 rounded-lg pl-9 pr-2 py-2 text-right focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition item-value ${type}-value" placeholder="0.00">
                </div>
            </div>
            <button type="button" class="remove-item bg-red-600 hover:bg-red-500 text-white font-bold p-2 rounded-lg transition h-10 w-10 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
            </button>
        `;

        list.appendChild(itemRow);
        itemRow.querySelector('input').focus();
        
        // Adiciona event listener para o novo input de valor e botão de remoção
        itemRow.querySelector('.item-value').addEventListener('input', updateTotal);
        itemRow.querySelector('.remove-item').addEventListener('click', () => {
            itemRow.remove();
            updateTotal();
        });
        updateTotal(); // Atualiza o total ao adicionar um novo item com valor 0
    };

    /**
     * Calcula e atualiza o valor total do orçamento.
     */
    const updateTotal = () => {
        const valueInputs = document.querySelectorAll('.item-value');
        let total = 0;
        valueInputs.forEach(input => {
            const value = parseFloat(input.value) || 0;
            total += value;
        });

        const totalValueEl = document.getElementById('total-value');
        totalValueEl.textContent = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    };

    /**
     * Gera o texto do orçamento com base nos dados do formulário.
     * @returns {string} O texto formatado do orçamento.
     */
    const generateBudgetText = () => {
        const clientName = document.getElementById('clientName').value.trim();
        const clientContact = document.getElementById('clientContact').value.trim();
        const deviceBrand = document.getElementById('deviceBrand').value.trim();
        const deviceModel = document.getElementById('deviceModel').value.trim();
        const total = document.getElementById('total-value').textContent;

        let budgetString = `📄 *ORÇAMENTO DE MANUTENÇÃO*\n\n`;
        budgetString += `*Data:* ${new Date().toLocaleDateString('pt-BR')}\n\n`;
        
        if (clientName) budgetString += `👤 *Cliente:* ${clientName}\n`;
        if (clientContact) budgetString += `📞 *Contato:* ${clientContact}\n\n`;
        
        if (deviceBrand || deviceModel) {
            budgetString += `💻 *Equipamento:* ${deviceBrand} ${deviceModel}\n\n`;
        }

        budgetString += `*SERVIÇOS PRESTADOS:*\n`;
        const services = document.querySelectorAll('#services-list .item-row');
        if (services.length > 0) {
            services.forEach(item => {
                const desc = item.querySelector('.service-desc').value.trim();
                const value = parseFloat(item.querySelector('.service-value').value) || 0;
                if (desc) {
                    budgetString += `  - ${desc}: ${value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\n`;
                }
            });
        } else {
            budgetString += `  (Nenhum serviço adicionado)\n`;
        }
        
        budgetString += `\n*PEÇAS / COMPONENTES:*\n`;
        const parts = document.querySelectorAll('#parts-list .item-row');
        if (parts.length > 0) {
            parts.forEach(item => {
                const desc = item.querySelector('.part-desc').value.trim();
                const value = parseFloat(item.querySelector('.part-value').value) || 0;
                if (desc) {
                    budgetString += `  - ${desc}: ${value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\n`;
                }
            });
        } else {
            budgetString += `  (Nenhuma peça adicionada)\n`;
        }

        budgetString += `\n--------------------\n`;
        budgetString += `💰 *VALOR TOTAL:* *${total}*\n`;
        budgetString += `--------------------\n\n`;
        budgetString += `Agradeço pela preferência!`;

        return budgetString;
    };

    /**
     * Mostra uma notificação na tela.
     * @param {string} message - A mensagem a ser exibida.
     */
    const showNotification = (message) => {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.classList.remove('opacity-0', 'translate-y-20');
        setTimeout(() => {
            notification.classList.add('opacity-0', 'translate-y-20');
        }, 3000);
    };

    // Event Listeners
    addServiceBtn.addEventListener('click', () => addItem('service', 'services-list'));
    addPartBtn.addEventListener('click', () => addItem('part', 'parts-list'));
    
    generateBtn.addEventListener('click', async () => {
        const budgetText = generateBudgetText();
        
        // Tenta usar a API de Compartilhamento (ótima para mobile)
        if (navigator.share) {
            try {
                await navigator.share({
                    title: 'Orçamento de Manutenção',
                    text: budgetText,
                });
            } catch (error) {
                console.error('Erro ao compartilhar:', error);
            }
        } else {
            // Fallback para desktop: Copiar para a área de transferência
            try {
                // Usa a API de Clipboard que é mais moderna e segura
                await navigator.clipboard.writeText(budgetText);
                showNotification('Orçamento copiado para a área de transferência!');
            } catch (err) {
                // Fallback do fallback para navegadores antigos
                const textArea = document.createElement('textarea');
                textArea.value = budgetText;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('Orçamento copiado para a área de transferência!');
                } catch (copyErr) {
                    console.error('Falha ao copiar o texto: ', copyErr);
                    showNotification('Erro ao copiar. Copie manualmente.');
                }
                document.body.removeChild(textArea);
            }
        }
    });

    resetBtn.addEventListener('click', () => {
        // Limpa todos os campos e listas
        document.getElementById('clientName').value = '';
        document.getElementById('clientContact').value = '';
        document.getElementById('deviceBrand').value = '';
        document.getElementById('deviceModel').value = '';
        servicesList.innerHTML = '';
        partsList.innerHTML = '';
        updateTotal(); // Reseta o total para R$ 0,00
    });

    // Adiciona uma linha de serviço e uma de peça por padrão para começar
    addItem('service', 'services-list');
    
});
</script>

</body>
</html>
